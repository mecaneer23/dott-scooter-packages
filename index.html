<html>

<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.13.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.13.0/brython_stdlib.js"></script>
    <!-- <script type="text/javascript" src="https://unpkg.com/commonmark@0.31.2/dist/commonmark.min.js"></script> -->
    <title>Dott Package Best Price Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <script type="text/python" id="calculator">
        from browser import document, html
        import calculate

        rides = int(input("Amount of rides: "))
        ride_len = int(input("Minutes per ride: "))

        dott = calculate.get_packages()
        # best_package = f"Best package for given price: {min(dott, key=lambda p: p.get_price(rides, ride_len))}"
        # table = [(str(p), p.get_price(rides, ride_len)) for p in dott]

        document <= html.P(f"Best package for given price: {min(dott, key=lambda p: p.get_price(rides, ride_len))}")
        document <= html.HR()
        document <= html.P("Cost for all packages:")
        table = html.TABLE()
        table <= html.TR([html.TD("Package price"), html.TD("Total cost")])
        for p in dott:
            table <= html.TR([html.TD(str(p)), html.TD(p.get_price(rides, ride_len))])
        document <= table
    </script>

    <!-- <script type="text/javascript">
        function toMarkdown() {
            const calc = __BRYTHON__.getPythonModule("calculator");
            let markdown = `
            ${calc.best_package}

            ---

            ${calc.table}
            `;
            let parsed = document.createElement("div");
            parsed.innerHTML = (new commonmark.HtmlRenderer()).render((new commonmark.Parser()).parse(markdown));
            console.log(parsed)
            document.appendChild(parsed);
        }
        document.getElementById("calculator").addEventListener("load", () => {
            toMarkdown();
        });
    </script> -->

</body>

</html>